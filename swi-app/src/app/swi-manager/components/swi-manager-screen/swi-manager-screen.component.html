<app-page [title]="'SWI Manager - ' + swi.title" [backButton]="true" [overrideBackButton]="true" [faIcon]="'fa-cubes'" (onBackButtonClick)="navBack()"
  [isLoading]="pageLoading" [loadingMessage]="loadingMessage">
  <!--Add Page level buttons here with page-button class-->
  <div class='page-body'>

    <div class="row">

      <div class="col-md-8">

        <swi-card [title]="'Commands'">

          <span class="badge card-badge" [ngClass]="{'badge-success': environment.isCurrentVersion(swi.appVersion), 'badge-warning': !environment.isCurrentVersion(swi.appVersion)}"
            *ngIf="swi.appVersion"> <i class="fa fa-info-circle"></i>  v{{swi?.appVersion}}</span>

          <div class="card-block">

            <div class="btn-container" data-toggle="buttons">

              <button type="button" (click)="viewSWI()" class="btn btn-success"><i class="fa fa-desktop"></i> View</button>
              <button type="button" (click)="editSWI()" class="btn btn-warning" *ngIf="!this.requiresUpgrade"><i class="fa fa-cubes"></i> Edit</button>
              <button type="button" swiUpgrade (completed)="upgradeComplete()" [swi]="swi" class="btn btn-warning" *ngIf="this.requiresUpgrade"><i class="fa fa-arrow-up"></i> Upgrade</button>
              <button type="button" swiDuplicateButton [swi]="swi" (started)="duplicatingStatus(true)" (completed)="duplicatingStatus(false)"
                class="btn btn-primary"><i class="fa fa-copy"></i> Duplicate</button>
              <button type="button" class="btn btn-primary" swiExportButton (exportStarted)="exportingStatus(true)" (exportCompelte)="exportingStatus(false)"
                [swi]="this.swi"><i class="fa fa-arrow-down"></i> Export</button>
              <button type="button" swiDeleteButton [swi]="swi" class="btn  btn-danger"><i class="fa fa-trash"></i> Delete</button>

            </div>

          </div>
        </swi-card>

        <swi-card [title]='"Login to Repository"' *ngIf="!isLoggedIn && (isOutOfSync || loadingRepoError)">
          <div class="card-block">
            <swi-login (loggedIn)="onLoggedIn()"></swi-login>
          </div>
        </swi-card>

        <tabset class="swi-tabs">
          <tab heading="Summary">
            <div class='card-block' *ngIf="!loadingRepo">
              <div *ngIf="!loadingRepoError">
                <!-- Repo Document Property Labels -->
                <div class="property-badge-list">
                  <span class="badge badge-info">SWI-{{swiMaster?.swiNumber}}</span>
                  <span class="badge badge-info">{{swiMaster?.type}}</span>
                  <span class="badge badge-info">Current SWI Revision: {{swiMaster?.latestRevision?.revisionNumber}}</span>
                </div>
                <br>
              </div>

              <div *ngIf="isLoggedIn">
                <div *ngIf="loadingRepoError">
                  <button type="button" [disabled]="loadingRepo" class="btn btn-lg btn-block btn-success" *ngIf="!isSyncing" (click)="this.syncRepo()"><i class="fa fa-plus"></i> Add to Repository</button>
                  <button type="button" [disabled]="true" class="btn btn-lg btn-block btn-success btn-zero-margin" *ngIf="isSyncing"><i class="fa fa-refresh fa-spin" [ngClass]="{'fa-spin': 'isSyncing'}"></i> Adding to Respository</button>
                </div>

                <div *ngIf="!loadingRepoError">
                  <p><strong>Logged In User: {{this.authService?.loggedInUser?.fullName}}</strong></p>
                  <textarea class="form-control" rows="3" [(ngModel)]="checkInMessage" placeholder="Brief comment on what has changed" style="margin-top: 0px; margin-bottom: 0px; height: 72px;"></textarea>
                  <button type="button" [disabled]="loadingRepo" class="btn btn-lg btn-block btn-warning btn-zero-margin" (click)="checkIn()"
                    *ngIf="!isSyncing"><i class="fa fa-arrow-up"></i> Check In To Repository</button>
                  <button type="button" [disabled]="true" class="btn btn-lg btn-block btn-warning btn-zero-margin" *ngIf="isSyncing"><i class="fa fa-refresh fa-spin" [ngClass]="{'fa-spin': 'isSyncing'}"></i> Checking Into Repository</button>
                </div>
              </div>
            </div>

          </tab>

          <tab heading="Revisions">
            <table class="table table-sm table-striped table-hover card-table" *ngIf="swiMaster && !loadingRepoError">
              <thead>
                <tr>
                  <th>Revision #</th>
                  <th>Released</th>
                  <th>Created On</th>
                  <th>Modified On</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let rev of swiMaster?.swiRevisions">
                  <td>{{rev.revisionNumber}}</td>
                  <td>{{rev.released}}</td>
                  <td>{{rev.createdOn | amCalendar}}</td>
                  <td>{{rev.modifiedOn | amCalendar}}</td>
                </tr>
              </tbody>
            </table>
          </tab>

          <tab heading="Document Changes">
            <table class="table table-sm table-striped table-hover card-table" *ngIf="swiMaster && !loadingRepoError">
              <thead>
                <tr>
                  <th>Updated On</th>
                  <th>User</th>
                  <th>Operation</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let c of swiMaster?.latestRevision?.document?.documentChanges">
                  <td>{{c.changedOn | amLocale:'en-GB' | amDateFormat:'MMMM Do YYYY, h:mm:ss a' }}</td>
                  <td>{{c.changedOn}}</td>
                  <td>{{c.changedBy}}</td>
                  <td>{{(c.changeOperation == 'Attach File') ? 'Sync' : c.changeOperation}}</td>
                  <td><strong>{{c.changeNotes}} </strong></td>
                </tr>
              </tbody>
            </table>
          </tab>
        </tabset>
      </div>

      <div class="col-md-4">
        <swi-card [title]="'SWI Overview'">
          <div class="card-block">
            <swi-img [imageKey]="swi.coverImage" [border]="true" width="100%" class="cover-image"></swi-img>
          </div>
        </swi-card>
      </div>

    </div>
  </div>
</app-page>
